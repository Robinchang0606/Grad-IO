# 关联方网络分析工具使用指南

## 工具概述

基于您提供的DTA文件结构，我已经创建了专门的关联方网络分析工具，可以计算上市公司的两个核心网络指标：

1. **指标1**: 关联公司间的直接投入/控制权益加总
2. **指标2**: 企业关联交易网络规模和复杂度

## 文件说明

### 核心工具文件
- `enhanced_related_party_analyzer.py` - **推荐使用**，功能最全面
- `related_party_network_analyzer.py` - 基础版本
- `simple_network_indicators.py` - 简化版本（通用网络分析）

### 文档文件
- `关联方网络分析使用指南.md` - 本使用指南
- `data_structure_guide.md` - 数据结构详细说明

## 快速开始

### 1. 使用示例数据运行
```bash
python3 enhanced_related_party_analyzer.py
```

### 2. 使用您的DTA文件
```python
from enhanced_related_party_analyzer import EnhancedRelatedPartyAnalyzer

# 初始化分析器
analyzer = EnhancedRelatedPartyAnalyzer()

# 加载您的DTA文件
analyzer.load_data_from_file('your_data.dta', 'dta')
# 或者加载CSV文件
# analyzer.load_data_from_file('your_data.csv', 'csv')

# 分析特定公司
stock_code = '000001'
report = analyzer.generate_detailed_report(stock_code)
print(report)

# 导出详细分析
analyzer.export_detailed_analysis(stock_code)
```

## 数据结构映射

您的DTA文件字段已完美映射到分析工具中：

| DTA字段 | 中文含义 | 工具中的使用 |
|---------|----------|--------------|
| Stkcd | 证券代码 | 主键，识别上市公司 |
| Repart | 关联方名称 | 关联方识别 |
| Relation | 关联关系代码 | 权重计算和分类统计 |
| Rigicy | 关联公司控制权益比例 | 指标1的核心数据 |
| Cogicy | 上市公司控制权益比例 | 指标1的核心数据 |
| Regcap | 关联公司注册资本 | 规模评估 |
| Corebs | 主营业务 | 业务多样性分析 |
| Site | 关联方所在地 | 地理分布分析 |

## 关联关系权重设计

工具根据关联关系的重要程度设置了权重：

| 代码 | 关联关系 | 权重 | 说明 |
|------|----------|------|------|
| 01 | 上市公司的母公司 | 1.0 | 最高权重 |
| 02 | 上市公司的子公司 | 0.9 | 高权重 |
| 03 | 同一母公司控制的其他企业 | 0.8 | 较高权重 |
| 04 | 实施共同控制的投资方 | 0.9 | 高权重 |
| 05 | 施加重大影响的投资方 | 0.8 | 较高权重 |
| 06 | 合营企业 | 0.7 | 中等权重 |
| 07 | 联营企业 | 0.7 | 中等权重 |
| 08-10 | 个人及管理层相关 | 0.5-0.6 | 较低权重 |
| 11-12 | 其他关联关系 | 0.3-0.4 | 最低权重 |

## 网络指标详解

### 指标1: 控制权益网络指标

**核心计算:**
- **接受控制权益总额** = Σ(Rigicy) - 所有关联方对该公司的控制权益
- **对外控制权益总额** = Σ(Cogicy) - 该公司对所有关联方的控制权益
- **净控制地位** = 对外控制权益 - 接受控制权益
- **加权控制评分** = Σ(max(Rigicy, Cogicy) × 关系权重)

**输出指标:**
- `total_control_received`: 接受控制权益总额
- `total_control_given`: 对外控制权益总额
- `net_control_position`: 净控制地位
- `weighted_control_score`: 加权控制评分
- `control_concentration`: 控制集中度

### 指标2: 网络规模复杂度指标

**核心计算:**
- **网络规模** = 关联方总数
- **关系多样性** = 不同关联关系类型数量
- **地理多样性** = 不同地理位置数量
- **业务多样性** = 不同业务类型数量
- **网络复杂度** = 0.3×规模因子 + 0.4×关系多样性 + 0.3×控制密度

**输出指标:**
- `total_related_parties`: 关联方总数
- `parent_companies`: 母公司数量
- `subsidiaries`: 子公司数量
- `sister_companies`: 同控企业数量
- `joint_ventures`: 合营企业数量
- `associates`: 联营企业数量
- `network_complexity_score`: 网络复杂度评分
- `geographic_diversity`: 地理多样性
- `business_diversity`: 业务多样性

## 实际运行结果示例

### 平安银行 (000001) 分析结果

```
【基础信息】
关联方总数: 5
报告日期: 2023-12-31

【控制关系分析】
接受控制权益: 52.38%
对外控制权益: 130.00%
净控制地位: 77.62%
加权控制评分: 163.38
控制集中度: 1.30

【网络结构分析】
关系类型多样性: 4
网络复杂度: 0.463
  - 母公司: 1 (中国平安保险集团)
  - 子公司: 1 (平安科技)
  - 同控企业: 2 (平安人寿、平安资管)
  - 联营企业: 1 (平安普惠)

【综合评分】
控制力评分: 1.000
复杂度评分: 0.463
地理评分: 0.400
业务评分: 1.000
综合影响力: 0.749
风险等级: 高风险
```

## 输出文件说明

### 1. 详细关联方信息 (`{股票代码}_related_parties_detail.csv`)
包含该公司所有关联方的详细信息：
- 关联方名称
- 关联关系代码和描述
- 控制权益比例
- 注册资本
- 业务范围
- 地理位置

### 2. 分析摘要 (`{股票代码}_analysis_summary.json`)
包含完整的分析结果，便于程序化处理

### 3. 汇总分析文件
- `related_party_indicator_1.csv` - 所有公司的指标1结果
- `related_party_indicator_2.csv` - 所有公司的指标2结果
- `related_party_combined_analysis.csv` - 综合分析结果

## 高级功能

### 1. 风险评估
工具会自动评估每个公司的关联交易风险等级：
- **高风险**: 综合影响力>0.7且(控制集中度>0.5或网络复杂度>0.6)
- **中风险**: 综合影响力>0.5或关联方数量>10
- **低风险**: 其他情况

### 2. 行业分类分析
自动识别关联方的行业分布：
- 金融相关（银行、保险、投资等）
- 科技相关（科技、技术、软件等）
- 房地产相关
- 制造业相关

### 3. 地理分布分析
区分国内和海外关联方，计算地理多样性

## 使用建议

### 1. 数据准备
- 确保DTA文件包含完整的关联方信息
- 检查数值字段（Rigicy, Cogicy, Regcap）的数据质量
- 如果有多年数据，建议分年度分析

### 2. 分析重点
- 关注**净控制地位**：正值表示控制他人多于被控制
- 关注**加权控制评分**：综合考虑关系重要性的控制力指标
- 关注**网络复杂度**：评估关联交易结构的复杂程度
- 关注**风险等级**：识别需要重点监控的公司

### 3. 结果解读
- **高控制集中度**：可能存在关联交易风险
- **高网络复杂度**：关联关系复杂，监管难度大
- **地理多样性高**：可能涉及跨境关联交易
- **业务多样性高**：关联交易类型丰富

## 扩展应用

1. **监管合规**: 识别关联交易风险较高的上市公司
2. **投资分析**: 评估公司的外部网络资源和控制结构
3. **学术研究**: 分析关联方网络对公司绩效的影响
4. **风险预警**: 建立基于网络指标的预警体系

这个工具为您的关联方网络分析提供了完整的解决方案，可以直接用于实际的研究和监管工作。